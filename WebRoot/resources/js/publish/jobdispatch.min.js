function dateCompare(a,b){var c=a.split("-"),d=new Date(c[0],c[1],c[2]),e=d.getTime(),f=b.split("-"),g=new Date(f[0],f[1],f[2]),h=g.getTime();return h>=e}function jobchaxun(){var a=document.getElementById("select_box_job_jobStatus_hdn").value,b=document.getElementById("select_box_job_equName_hdn").value,c=document.getElementById("select_box_job_part_hdn").value,d=document.getElementById("select_box_job_taskNum_hdn").value,e=document.getElementById("myform:startInputDate").value,f=document.getElementById("myform:endInputDate").value;dateCompare(e,f)?(this.eventStore.load({params:{taskNum:d,jobstatus:a,partid:c,equid:b,planStime:e,planEtime:f},callback:function(){ds.setStart(new Date(Date.parse(e.replace(/-/g,"/")))),ds.setEnd(new Date(Date.parse(f.replace(/-/g,"/"))))},scope:this,add:!1}),this.resourceStore.load({params:{taskNum:d,jobstatus:a,partid:c,equid:b,planStime:start,planEtime:end},callback:function(){changetr()},scope:this,add:!1})):jAlert(ext_tip23)}function loadCookie(){var a="jobdispathcNo",b=document.cookie.match(new RegExp(";?"+a+"=([^;]*)","i"));null!=b&&(this.eventStore.filter(function(a){return a.get("no")==b[1]?!0:void 0}),delcookie(a))}function delcookie(a){var b=new Date;b.setTime(b.getTime()-1);var c=getCookie(a);null!=c&&(document.cookie=a+"="+c+";expires="+b.toGMTString())}function init(){for(i in document.images)disableDraggingFor(document.images[i])}function disableDraggingFor(a){a.draggable=!1,a.onmousedown=function(a){return a.preventDefault(),!1}}function setValueforHidd(){var a=document.getElementById("select_box_job_part_hdn").value,b=document.getElementById("select_box_job_equName_hdn").value,c=document.getElementById("select_box_job_taskNum_hdn").value,d=document.getElementById("select_box_job_jobStatus_hdn").value;d||(d="10,20,30,40,50,80"),document.getElementById("myform:partTypeId").value=a,document.getElementById("myform:taskNum").value=c,document.getElementById("myform:eduTypeId").value=b,document.getElementById("myform:jobState").value=d}function chaxun_one(){document.getElementById("myform:chaxun_one").click()}function chaxun_two(){document.getElementById("myform:chaxun_two").click()}function onloadTab(a){"tab1"==a?(document.getElementById("example-container").style.display="block",document.getElementById("divtab2").style.display="none",document.getElementById("divtab3").style.display="none",document.getElementById("div_one").style.display="block",document.getElementById("div_two").style.display="block",document.getElementById("fenzu").style.visibility="hidden"):(document.getElementById("myform:group").value=1,document.getElementById("example-container").style.display="none",document.getElementById("divtab2").style.display="block",document.getElementById("div_one").style.display="block",document.getElementById("div_two").style.display="none",document.getElementById("fenzu").style.visibility="visible")}function sub(a){"tab1"==a?(document.getElementById("myform:loadtab").value="tab1",document.getElementById("gttimg").src="./images/tabselected.png",document.getElementById("gtt").style.color="white",document.getElementById("gdlbimg").src="./images/tabselect.png",document.getElementById("gdlb").style.color="#5a5a5a"):(document.getElementById("myform:loadtab").value="tab2",document.getElementById("gttimg").src="./images/tabselect.png",document.getElementById("gtt").style.color="#5a5a5a",document.getElementById("gdlbimg").src="./images/tabselected.png",document.getElementById("gdlb").style.color="white",document.getElementById("myform:jobQuery").click()),onloadTab(a)}function dateCompare(a,b){var c=a.split("-"),d=new Date(c[0],c[1],c[2]),e=b.split("-"),f=new Date(e[0],e[1],e[2]);return d.getTime()<=f.getTime()}function querybtn(){var a=document.getElementById("myform:loadtab").value,b=document.getElementById("myform:startInputDate").value,c=document.getElementById("myform:endInputDate").value;if(!dateCompare(b,c))return void jAlert(ext_tip23);if("tab1"==a)getTipMsg(),jobchaxun();else{var d=document.getElementById("myform:group").value;1==d?document.getElementById("myform:chaxun_one").click():2==d&&document.getElementById("myform:chaxun_two").click()}}function select(){var a=document.getElementById("myform:group").value;1==a?(document.getElementById("divtab3").style.display="none",document.getElementById("divtab2").style.display="block",document.getElementById("myform:jobQuery").click()):2==a&&(document.getElementById("divtab2").style.display="none",document.getElementById("divtab3").style.display="block",document.getElementById("myform:jobQueryByEqu").click())}function changetr(){$("#gridview-1028-table>tbody>tr>td>div").each(function(){var a=$(this).height();$(this).css("line-height",a+"px")})}function openUrl(a){features="height=858,width=1331,top:200,left:200,status=no,toolbar=no,menubar=no,location=no,scrollbars=yes,resizable=no",winId=window.open(a,"addpage2",features)}function switchV(){switch(arguments[0]){case"week":ds.switchViewPreset("weekAndDay",start,end),zflag=1,ds.scrollToDate(new Date,!0);break;case"month":ds.switchViewPreset("monthAndYear",start,end),zflag=2,ds.scrollToDate(new Date,!0);break;case"year":ds.switchViewPreset("year",start,end),zflag=3,ds.scrollToDate(new Date,!0)}}function enlargeOrnarrow(){if("enlarge"==arguments[0]){if(1==zflag)return ds.switchViewPreset("monthAndYear",start,end),zflag=2,void ds.scrollToDate(new Date,!0);if(2==zflag)return ds.switchViewPreset("year",start,end),zflag=3,void ds.scrollToDate(new Date,!0)}else{if(3==zflag)return ds.switchViewPreset("monthAndYear",start,end),zflag=2,void ds.scrollToDate(new Date,!0);if(2==zflag)return ds.switchViewPreset("weekAndDay",start,end),zflag=1,void ds.scrollToDate(new Date,!0)}}function pageRelocation(){switch(getTipMsg(),arguments[0]){case"edit":-1==editPlanId?jAlert(ext_tip8):30==statusId||20==statusId||80==statusId?(document.getElementById("jobdispatchupdateshadow").style.display="block",document.getElementById("jobdispatchupdate2").src="./jobdispatch/jobdispatch_updata.faces?editPId="+editPlanId):jAlert(ext_tip22);break;case"statistic":openUrl("./jobdispatchstatics/jobdispatchstatics.faces?editPId="+editPlanId);break;case"add":document.getElementById("jobdispatchaddshadow").style.display="block",document.getElementById("jobdispatchadd2").src="./jobdispatch/jobdispatch_add.faces"}}function pageLoad(){-1==editPlanId?jAlert(ext_tip8):openUrl("./jobdispatch/jobdispatchNumEdit.faces?jobdispatchId="+editPlanId)}function changeStatus(a,b,c,d,e,f,g,h){if(goodQuantity=h,equSerialNo=d,partName=e,planNum=f,processNum=f,dispatchNo=g,editPlanId=b,statusId=c,"edit"==a)return pageRelocation(a);var i=switchStatus(a);return i}function getTipMsg(){dataTranslate("jobdispatch",function(a){ext_tip1=a("content.ext_tip1"),ext_tip2=a("content.ext_tip2"),ext_tip3=a("content.ext_tip3"),ext_tip4=a("content.ext_tip4"),ext_tip5=a("content.ext_tip5"),ext_tip6=a("content.ext_tip6"),ext_tip7=a("content.ext_tip7"),ext_tip8=a("content.ext_tip8"),ext_tip9=a("content.ext_tip9"),ext_tip10=a("content.ext_tip10"),ext_tip11=a("content.ext_tip11"),ext_tip12=a("content.ext_tip12"),ext_tip13=a("content.ext_tip13"),ext_tip14=a("content.ext_tip14"),ext_tip15=a("content.ext_tip15"),ext_tip16=a("content.ext_tip16"),ext_tip17=a("content.ext_tip17"),ext_tip18=a("content.ext_tip18"),ext_tip19=a("content.ext_tip19"),ext_tip20=a("content.ext_tip20"),ext_tip21=a("content.ext_tip21"),ext_tip22=a("content.ext_tip22"),ext_tip23=a("content.ext_tip23"),ext_tip24=a("content.ext_tip24"),ext_tip25=a("content.ext_tip25"),ext_tip26=a("content.ext_tip26"),ext_tip27=a("content.ext_tip27"),ext_tip28=a("content.ext_tip28"),ext_tip29=a("content.ext_tip29"),ext_tip30=a("content.ext_tip30")})}function switchStatus(){if(getTipMsg(),"dispatch"==arguments[0]&&(-1!=editPlanId?20==statusId?Ext.Ajax.request({url:"./jobdispatch/checkDispathById.action",method:"post",params:{dispatchNo:dispatchNo},success:function(a){var b=Ext.decode(a.responseText);b.flag?jConfirm(ext_tip1+b.equSerialNo+ext_tip2,null,function(a){return a?void Ext.Ajax.request({url:"./jobdispatch/updateJobdispatchStatus.action",params:{dispatchId:editPlanId,status:30,flag:0},success:function(a){var b=a.responseText;"true"==b?(jAlert(ext_tip3),ds.getEventStore().reload(),statusId=30):"false"==b&&jAlert(ext_tip4)},failure:function(){jAlert(ext_tip5)}}):!1}):jAlert(ext_tip6)},failure:function(){jAlert(ext_tip5)}}):jAlert(ext_tip7):jAlert(ext_tip8)),"delete"==arguments[0]&&(30==statusId||20==statusId?jConfirm(ext_tip9,null,function(a){return a?void Ext.Ajax.request({url:"./jobdispatch/delete.action",method:"post",params:{dispatchId:editPlanId},success:function(){ds.getEventStore().reload(),editPlanId=-1},failure:function(){jAlert(ext_tip5)}}):!1}):jAlert(ext_tip10)),"start"==arguments[0]&&(-1!=editPlanId?30==statusId||80==statusId||70==statusId?30==statusId?Ext.Ajax.request({url:"./jobdispatch/checkDispathById.action",method:"post",params:{dispatchNo:dispatchNo},success:function(a){var b=Ext.decode(a.responseText);jConfirm(ext_tip11+b.equSerialNo+ext_tip12+partName+ext_tip13+planNum+ext_tip14,null,function(a){if(!a)return!1;var b=0;Ext.Ajax.request({url:"./jobdispatch/updateJobdispatchStatus.action",method:"post",params:{dispatchId:editPlanId,status:40,flag:b},success:function(a){var b=a.responseText;"true"==b?(jAlert(ext_tip15),ds.getEventStore().reload(),statusId=40):"false"==b&&jAlert(ext_tip16)},failure:function(){jAlert(ext_tip5)}})})}}):jConfirm(ext_tip17+processNum+ext_tip18+goodQuantity+ext_tip19,null,function(a){if(!a)return!1;var b=0;Ext.Ajax.request({url:"./jobdispatch/updateJobDispatchWhenStop.action",method:"post",params:{jobdispatchId:editPlanId,status:60,flag:b},success:function(a){var b=a.responseText;"true"==b?(jAlert(ext_tip20),ds.getEventStore().reload(),statusId=60):"false"==b&&jAlert(ext_tip21)},failure:function(){jAlert(ext_tip5)}})}):jAlert(ext_tip24):jAlert(ext_tip8)),"pause"==arguments[0])if(-1!=editPlanId)if(50==statusId||40==statusId)jConfirm(ext_tip25,null,function(a){if(!a)return!1;var b=0;Ext.Ajax.request({url:"./jobdispatch/updateJobDispatchWhenPause.action",method:"post",params:{dispatchId:editPlanId,status:80,flag:b},success:function(a){var b=a.responseText;"true"==b?(jAlert(ext_tip26),ds.getEventStore().reload(),statusId=80):"false"==b&&jAlert(ext_tip27)},failure:function(){jAlert(ext_tip5)}})});else if(80==statusId){var a=0;Ext.Ajax.request({url:"./jobdispatch/updateJobdispatchWhenRecover.action",method:"post",params:{dispatchId:editPlanId,status:50,flag:a},success:function(a){var b=a.responseText;"true"==b?(jAlert(ext_tip28),ds.getEventStore().reload(),statusId=50):"false"==b&&jAlert(ext_tip29)},failure:function(){jAlert(ext_tip5)}})}else jAlert(ext_tip30);else jAlert(ext_tip8);return!0}function transTableContent(){$(".ui-tt-c>span>a").each(function(){$(this).attr("data-i18n",$(this).text()).i18n()})}Ext.ns("App"),Ext.Loader.setConfig({enabled:!0,disableCaching:!0}),Ext.Loader.setPath("App","."),Ext.Loader.setPath("Sch.plugin",".");var editPlanId=-1,statusId=-1,start,end,jId,rId,titleField,locationField,planId,planNumField,processNum,goodQuantity,dispatchNo,createWidth=1920*wjb51/1920,createHeight=642*hjb51/1080,createRowHeight=40*hjb51/1080,createColumnWidth=480*wjb51/1920,fieldWidth=200*wjb51/1920,defineWidth=395*wjb51/1920,defineHeight=350*hjb51/1080,fsize=5,resourceStore,eventStore,equSerialNo;Ext.onReady(function(){Ext.QuickTips.init(),Ext.define("Resource",{extend:"Sch.model.Resource",fields:["Id","Name"]}),Ext.define("Event",{extend:"Sch.model.Event",fields:["Id","no","Name","TprocessName","planNum","finishNum","Percentage","Status","rId","goodQuantity","StatusName","partName","equSerialNo","batchNo"]}),resourceStore=Ext.create("Sch.data.ResourceStore",{model:"Resource",proxy:{type:"ajax",url:"./jobdispatch/getDevicesList.action",reader:{type:"json",root:"data"}},sortInfo:{field:"Id",direction:"ASC"}}),eventStore=Ext.create("Sch.data.EventStore",{model:"Event",proxy:{type:"ajax",url:"./jobdispatch/getjobDispatchList.action",reader:{type:"json",root:"data"}}});var a=new Date;a.setMonth(a.getMonth()-1),a.setDate(1),start=a;var b=new Date;b.setMonth(b.getMonth()+2),b.setDate(1),b=new Date(b.getTime()-864e5),end=b,resourceStore.load({params:{taskNum:"",jobstatus:"",partid:"",planStime:start,planEtime:end},callback:function(){},scope:this,add:!1}),eventStore.load({params:{taskNum:"",jobstatus:"",partid:"",planStime:start,planEtime:end},callback:function(){changetr()},scope:this,add:!1});var c,d,e,f,g,h,i,j,k,l,m,n,o;dataTranslate("jobdispatch",function(a){c=a("content.tooltip_1"),d=a("content.tooltip_2"),e=a("content.tooltip_3"),f=a("content.tooltip_4"),g=a("content.tooltip_5"),h=a("content.tooltip_6"),i=a("content.tooltip_7"),j=a("content.tooltip_8"),k=a("content.tooltipUnit"),l=a("top.btn7"),m=a("top.btn7-2"),n=a("top.btn8"),o=a("top.btn8-2")}),ds=Ext.create("Sch.panel.SchedulerGrid",{renderTo:"example-container",width:createWidth,height:createHeight,rowHeight:createRowHeight,eventStore:eventStore,resourceStore:resourceStore,constrainDragToResource:!0,useArrows:!1,icon:null,rootVisible:!0,viewPreset:"monthAndYear",startDate:start,endDate:end,multiSelect:!0,columnLines:!1,rowLines:!0,enableDragCreation:!1,enableEventDragDrop:!1,columns:[{text:'<span data-i18n="content.tree_title"></span>',width:createColumnWidth-2,sortable:!1,menuDisabled:!0,dataIndex:"Name"}],eventBodyTemplate:new Ext.XTemplate('<div class="sch-percent-allocated-bar" style="width:{Percentage}%;"></div><span id="sch-percent-allocated-text" class="sch-percent-allocated-text">{[values.Name]}</span>').compile(),tooltipTpl:new Ext.XTemplate('<dl class="eventTip" style="font-size:16px;">','<dt class="icon-clock">'+d+':{[Ext.Date.format(values.StartDate, "Y-m-d G:i")]} </dt>','<dt class="icon-clock">'+e+':{[Ext.Date.format(values.EndDate, "Y-m-d G:i")]} </dt>','<dt class="icon-task">'+c+":{partName}</dt>",'<dt class="icon-task">'+f+":{TprocessName}</dt>",'<dt class="icon-task">'+g+":{planNum} </dt>",'<dt class="icon-task">'+h+":{finishNum} </dt>",'<dt class="icon-task">'+i+":{StatusName}</dt>","</dl>").compile(),onEventCreated:function(){}}),dataTranslate("jobdispatch",function(){$("#example-container *[data-i18n]").i18n()}),ds.on("eventcontextmenu",function(a,b,c){b.data.Id;c.stopEvent()}),ds.on("beforeeventresize",function(){return!1}),ds.on("beforeeventdrag",function(){return!1}),ds.on("beforedragcreate",function(){return!1}),ds.on("eventclick",function(a,b){$(".zl-content-top-info-down-btn").removeClass("active"),"false"!=$("#myform\\:viewDisabled").val()&&($("#control_add,#control_week,#control_month,#control_year").parent().addClass("active"),titleField.setValue(b.data.no),locationField.setValue(b.data.partName),planNumField.setValue(b.data.planNum),editPlanId=b.data.Id,rId=b.data.rId,dispatchNo=b.data.no,equSerialNo=b.data.equSerialNo,partName=b.data.partName,planNum=b.data.planNum,processNum=b.data.planNum,goodQuantity=b.data.finishNum,statusId=b.data.Status,20==statusId&&($("#control_edit").parent().addClass("active"),$("#control_delete").parent().addClass("active"),$("#control_ok").parent().addClass("active")),30==statusId&&($("#control_edit").parent().addClass("active"),$("#control_delete").parent().addClass("active"),$("#control_start").attr("title",l).parent().addClass("active").find(".zl-content-top-info-down-btn-img").attr("src","images/jobplan/icon_play.png")),40==statusId&&($("#control_start").attr("title",l).find(".zl-content-top-info-down-btn-img").attr("src","images/jobdispatch/icon_stop.png"),$("#control_pause").attr("title",n).parent().addClass("active").find(".zl-content-top-info-down-btn-img").attr("src","images/jobdispatch/icon_pause.png")),50==statusId&&$("#control_pause").attr("title",n).parent().addClass("active").find(".zl-content-top-info-down-btn-img").attr("src","images/jobdispatch/icon_pause.png"),70==statusId&&($("#control_ok").parent().addClass("active"),$("#control_start").attr("title",m).parent().addClass("active").find(".zl-content-top-info-down-btn-img").attr("src","images/jobdispatch/icon_stop.png"),$("#control_pause").attr("title",n).parent().addClass("active").find(".zl-content-top-info-down-btn-img").attr("src","images/jobdispatch/icon_pause.png")),80==statusId&&($("#control_edit").parent().addClass("active"),$("#control_start").attr("title",m).parent().addClass("active").find(".zl-content-top-info-down-btn-img").attr("src","images/jobdispatch/icon_stop.png"),$("#control_pause").attr("title",o).parent().addClass("active").find(".zl-content-top-info-down-btn-img").attr("src","images/jobdispatch/icon_restart.png")))}),titleField=new Ext.form.TextField({name:"no",labelAlign:"right",width:fieldWidth}),locationField=new Ext.form.TextField({name:"Name",labelAlign:"right",width:fieldWidth}),planNumField=new Ext.form.TextField({name:"planNum",labelAlign:"right",width:fieldWidth}),titleField.render("tjpId"),locationField.render("tjpName"),planNumField.render("tjpnum"),loadCookie()}),App.Scheduler={init:function(){this.scheduler=this.createScheduler()},createScheduler:function(){return ds}};var flag=!0,eventData,zflag=1,ext_tip1="",ext_tip2="",ext_tip3="",ext_tip4="",ext_tip5="",ext_tip6="",ext_tip7="",ext_tip8="",ext_tip9="",ext_tip10="",ext_tip11="",ext_tip12="",ext_tip13="",ext_tip14="",ext_tip15="",ext_tip16="",ext_tip17="",ext_tip18="",ext_tip19="",ext_tip20="",ext_tip21="",ext_tip22="",ext_tip23="",ext_tip24="",ext_tip25="",ext_tip26="",ext_tip27="",ext_tip28="",ext_tip29="",ext_tip30="";$(document).ready(function(){dataTranslate("jobdispatch",function(){"zh"==i18n.options.lng?$("*[data-i18n]").i18n():($("#control_week").find(".zl-content-top-info-down-btn-img").attr("src","images/jobplan/icon_week-02.png"),$("#control_month").find(".zl-content-top-info-down-btn-img").attr("src","images/jobplan/icon_month-02.png"),$("#control_year").find(".zl-content-top-info-down-btn-img").attr("src","images/jobplan/icon_year-02.png"),$("*[data-i18n]").i18n())}),$("#select_box_job_part").selectboxs(),$("#select_box_job_jobStatus").selectboxs(),$("#select_box_job_taskNum").selectboxs(),$("#select_box_job_equName").selectboxs(),"false"==$("#myform\\:viewDisabled").val()&&$("#control_info_edit,#control_scrap,#control_add,#control_edit,#control_delete,#control_ok,#control_start,#control_pause,#control_week,#control_month,#control_year").css("cursor","default").attr("onclick","return false;"),$.autosizeExclude($("#img4")[0],!1),$.autosizeExclude($("#img5")[0],!1),$.autosizeExclude($("#img6")[0],!1),$.autosizeExclude($("#example-container")[0],!0)});