function query(a){var b=document.getElementById("myform:startInputDate").value,c=document.getElementById("myform:endInputDate").value,d=document.getElementById("select_box_part_hdn").value,e=document.getElementById("select_box_hdn").value;ds.setStart(new Date(b)),ds.setEnd(new Date(c)),ds.scrollToDate(new Date,!0),this.resourceStore.load({params:{partid:d,planStatus:e,startTime:b,endTime:c,isexpand:a},callback:function(){},scope:this,add:!1}),Ext.Ajax.request({url:"./jobplan/getjobEvent.action",method:"post",params:{partid:d,planStatus:e,startTime:b,endTime:c},success:function(a){var b=Ext.decode(a.responseText);this.eventStore.loadData(b.data)},failure:function(){}})}function changeWorkPlanLength(a){Ext.Ajax.request({url:"./jobplan/update.action",method:"post",dataType:"json",success:function(){Ext.Msg.alert("提示","修改作业计划长度成功!",function(){ds.getEventStore().reload()})},failure:function(){Ext.Msg.alert("failure")},params:{m:"",startTime:a.data.StartDate,endTime:a.data.EndDate,id:a.data.Id,statusFlag:a.data.Status}})}function jobplanadd1(){var a=document.getElementById("myform:plantype").value,b=document.getElementById("myform:flgId").value,c=document.getElementById("myform:planId").value,d=document.getElementById("myform:partId1").value,e=document.getElementById("myform:subjobplanStartDate").value,f=document.getElementById("myform:subjobplanEndDate").value;"1"==a?(document.getElementById("jobaddshadow").style.display="block",document.getElementById("jobplanadd2").src="./jobplan/jobplan_add.faces?planId="+c+" ",document.getElementById("myform:plantype").value=null):"2"==a?(document.getElementById("jobdispatchaddshadow").style.display="block",document.getElementById("jobdispatchadd2").src="./jobdispatch/jobdispatch_add.faces?partId="+d+"&StartDate="+e+"&EndDate="+f+"&planId="+c,document.getElementById("myform:plantype").value=null):null!=b&&""!=b?(document.getElementById("jobaddshadow").style.display="block",document.getElementById("jobplanadd2").src="./jobplan/jobplan_add.faces?partId="+b+" ",document.getElementById("myform:flgId").value=null):document.getElementById("jobaddshadow").style.display="none"}function importadd(){document.getElementById("taskimportshadow").style.display="block",document.getElementById("taskimport2").src="./erp/import_add.faces "}function switchV(){switch(arguments[0]){case"week":ds.switchViewPreset("weekAndDay",start,end),zflag=1,ds.scrollToDate(new Date,!0);break;case"month":ds.switchViewPreset("monthAndYear",start,end),zflag=2,ds.scrollToDate(new Date,!0);break;case"year":ds.switchViewPreset("year",start,end),zflag=3,ds.scrollToDate(new Date,!0)}}function pageRelocation(){switch(getTipMsg(),arguments[0]){case"edit":-1==editPlanId?jAlert(tipTitle1):1==planType?(document.getElementById("jobupdateshadow").style.display="block",document.getElementById("jobplanupdate2").src="./jobplan/jobplan_updata.faces?editPId="+editPlanId+" ",editPlanId=-1):60==statusId||70==statusId?jAlert(tipTitle2):(document.getElementById("jobupdateshadow").style.display="block",document.getElementById("jobplanupdate2").src="./jobplan/jobplan_updata.faces?editPId="+editPlanId+" ",editPlanId=-1);break;case"control":-1==editPlanId?Ext.Msg.alert(tipTitle3,tipTitle1,function(){}):(openUrl("./jobplan/jobplan_control.faces?editPId="+editPlanId),editPlanId=-1);break;case"statistic":openUrl("./jobplan/jobplan_statistics.faces"),editPlanId=-1}}function deljobPlan(){getTipMsg(),-1==editPlanId?jAlert(tipTitle1):10==statusId?jConfirm(tipTitle4,null,function(a){a&&Ext.Ajax.request({url:"./jobplan/delete.action",method:"post",params:{id:editPlanId},success:function(a){var b=Ext.decode(a.responseText);b.success?(jAlert(tipTitle5),editPlanId=-1,query("true")):jAlert(tipTitle6)},failure:function(){alert(tipTitle7)}})}):jAlert(tipTitle8)}function openUrl(a){features="height=858,width=1331,top:200,left:200,status=no,toolbar=no,menubar=no,location=no,scrollbars=yes,resizable=no",winId=window.open(a,"addpage",features)}function getTipMsg(){dataTranslate("jobplan_detail",function(a){tipTitle1=a("content.tipTitle1"),tipTitle2=a("content.tipTitle2"),tipTitle3=a("content.tipTitle3"),tipTitle4=a("content.tipTitle4"),tipTitle5=a("content.tipTitle5"),tipTitle6=a("content.tipTitle6"),tipTitle7=a("content.tipTitle7"),tipTitle8=a("content.tipTitle8"),tipTitle9=a("content.tipTitle9"),tipTitle10=a("content.tipTitle10"),tipTitle11=a("content.tipTitle11"),tipTitle12=a("content.tipTitle12"),tipTitle13=a("content.tipTitle13"),tipTitle14=a("content.tipTitle14"),tipTitle15=a("content.tipTitle15")})}function switchStatus(){if(getTipMsg(),-1!=editPlanId){if(1==planType)return void jAlert(tipTitle9);10==statusId||20==statusId?jConfirm(tipTitle10,null,function(a){a&&(10==statusId?Ext.Ajax.request({url:"./jobplan/updateJobPlanInfoStatus.action",method:"post",params:{jobPlanId:editPlanId,status:40},success:function(a){var b=a.responseText;"true"==b?(jAlert(tipTitle11),query("true"),statusId=40):"false"==b&&jAlert(tipTitle12)},failure:function(){jAlert(tipTitle13)}}):70==statusId&&Ext.Ajax.request({url:"./jobplan/updateJobPlanInfoStatus.action",method:"post",params:{jobPlanId:editPlanId,status:60},success:function(a){var b=a.responseText;"true"==b?Ext.Msg.alert(tipTitle3,tipTitle14,function(){query("true"),statusId=60}):"false"==b&&jAlert(tipTitle15)},failure:function(){jAlert(tipTitle13)}}))}):jAlert(tipTitle8)}else jAlert(tipTitle1)}function showNewPage(a){var b="";switch(a){case"statistic":b="./jobplan/jobplan_statistics.faces"}$("#showDiv").show(),$("#disableAll").show(),$("#ifContent").attr("src",b)}function closeIf(){$("#showDiv").hide(),$("#disableAll").hide(),$("#ifContent").attr("src","")}Ext.ns("App"),Ext.Loader.setConfig({enabled:!0,disableCaching:!0}),Ext.Loader.setPath("App","."),Ext.Loader.setPath("Sch.plugin",".");var editPlanId=-1,statusId=-1,start,end,titleField,locationField,pId,planNumField,priId,planType,createWidth=1920*wjb51/1920,createHeight=720*hjb51/1080,createRowHeight=40*hjb51/1080,createColumnWidth=480*wjb51/1920,resourceStore,eventStore;Ext.onReady(function(){Ext.QuickTips.init();var a=new Date;a.setMonth(a.getMonth()-1),a.setDate(1),start=a;var b=new Date;b.setMonth(b.getMonth()+2),b.setDate(1),b=new Date(b.getTime()-864e5),end=b,document.getElementById("myform:startInputDate").value=Ext.Date.format(a,"Y-m-d"),document.getElementById("myform:endInputDate").value=Ext.Date.format(b,"Y-m-d"),Ext.define("Resource",{extend:"Sch.model.Resource",fields:["Type"]}),Ext.define("Event",{extend:"Sch.model.Event",fields:["No","Name","planId","finishNum","planNum","Priority","Percentage","Status","jobPlanfinisNum","partName","planType","statusName","partId"]}),resourceStore=Ext.create("Sch.data.ResourceTreeStore",{model:"Resource",proxy:{type:"ajax",extraParams:{partid:document.getElementById("select_box_part_hdn").value,planStatus:document.getElementById("select_box_hdn").value,startTime:Ext.Date.format(a,"Y-m-d"),endTime:Ext.Date.format(b,"Y-m-d"),isexpand:"true"},url:"./jobplan/getjobplanName.action"},sortInfo:{field:"Id",direction:"ASC"}}),eventStore=Ext.create("Sch.data.EventStore",{model:"Event",proxy:{type:"ajax",extraParams:{ishighlight:"true",partid:document.getElementById("select_box_part_hdn").value,planStatus:document.getElementById("select_box_hdn").value,startTime:Ext.Date.format(a,"Y-m-d"),endTime:Ext.Date.format(b,"Y-m-d")},url:"./jobplan/getjobEvent.action",reader:{type:"json",root:"data"}}}),resourceStore.load(),eventStore.load();var c,d,e,f,g,h,i,j;dataTranslate("jobplan_detail",function(a){c=a("content.tooltip_1"),d=a("content.tooltip_2"),e=a("content.tooltip_3"),f=a("content.tooltip_4"),g=a("content.tooltip_5"),h=a("content.tooltip_6"),i=a("content.tooltip_7"),j=a("content.tooltipUnit")}),ds=Ext.create("Sch.panel.SchedulerTree",{renderTo:"example-container",width:createWidth,height:createHeight,rowHeight:createRowHeight,eventStore:eventStore,resourceStore:resourceStore,constrainDragToResource:!0,useArrows:!1,icon:null,rootVisible:!0,viewPreset:"monthAndYear",startDate:start,endDate:end,multiSelect:!0,columnLines:!1,rowLines:!0,enableDragCreation:!1,enableEventDragDrop:!1,onEventCreated:function(a){a.set("Name","New departure")},columns:[{xtype:"treecolumn",text:'<span data-i18n="content.tree_title"></span>',width:createColumnWidth-2,sortable:!1,dataIndex:"Name"}],eventBodyTemplate:new Ext.XTemplate('<div class="sch-percent-allocated-bar" style="width:{Percentage}%;"></div><span id="sch-percent-allocated-text" class="sch-percent-allocated-text">{[values.planNum]}/{[values.finishNum]}</span>').compile(),tooltipTpl:new Ext.XTemplate('<dt class="blocking">'+c+": {partName}</dt>",'<dt class="icon-clock">'+d+': {[Ext.Date.format(values.StartDate, "Y-m-d G:i")]} </dt>','<dt class="icon-clock">'+e+': {[Ext.Date.format(values.EndDate, "Y-m-d G:i")]} </dt>','<dt class="icon-task">'+f+": {Name}</dt>",'<dt class="connecting">'+g+": {planNum} "+j+"</dt>",'<dt class="blocking">'+h+": {finishNum} "+j+"</dt>",'<dt class="blocking">'+i+": {statusName}</dt>","</dl>").compile()}),ds.scrollToDate(new Date,!0),dataTranslate("jobplan_detail",function(){$("#example-container *[data-i18n]").i18n()}),ds.on("eventresizeend",function(a,b){10==b.data.Status&&changeWorkPlanLength(b),20==b.data.Status&&changeWorkPlanLength(b),30==b.data.Status&&changeWorkPlanLength(b),(40==b.data.Status||50==b.data.Status)&&(document.getElementById("hplanStartTime").value!=b.data.StartDate?Ext.Msg.alert("提示","此状态只能拖动计划结束时间!",function(){}):changeWorkPlanLength(b)),(60==b.data.Status||70==b.data.Status)&&Ext.Msg.alert("提示","此状态拖动无效!",function(){})}),ds.on("eventresizestart",function(a,b){(40==b.data.Status||50==b.data.Status)&&(document.getElementById("hplanStartTime").value=b.data.StartDate)}),ds.on("select",function(a,b){if(b.id.indexOf("Resource")>=0){var c=b.data.Id;document.getElementById("myform:flgId").value=c,$("#control_add").parent().addClass("active")}}),ds.on("eventclick",function(a,b){statusId=b.data.Status,planType=b.data.planType;var c=b.data.Id,d=b.data.partId;editPlanId=c,document.getElementById("myform:plantype").value=b.data.planType;var e=Ext.Date.format(b.data.StartDate,"Y-m-d G:i"),f=Ext.Date.format(b.data.EndDate,"Y-m-d G:i");if($(".zl-content-top-info-down-btn").removeClass("active"),"false"!=$("#myform\\:viewDisabled").val()){$("#control_edit,#control_week,#control_month,#control_year,#control_big,#control_small").parent().addClass("active");var g,h;dataTranslate("jobplan_detail",function(a){g=a("top.btn1"),h=a("top.btn1_2")}),1==planType?($("#control_add").attr("title",g).parent().addClass("active"),$("#control_add").attr("href","javascript:void(1);"),document.getElementById("myform:planId").value=c):2==planType&&($("#control_add").attr("title",h).parent().addClass("active"),10==statusId&&$("#control_del").parent().addClass("active"),document.getElementById("myform:planId").value=c,document.getElementById("myform:partId1").value=d,document.getElementById("myform:subjobplanStartDate").value=e,document.getElementById("myform:subjobplanEndDate").value=f),1==b.data.planType||10==statusId&&$("#control_status").parent().addClass("active"),jobName=b.data.Name}})}),App.Scheduler={init:function(){this.scheduler=this.createScheduler()},createScheduler:function(){return ds}},$(document).ready(function(){dataTranslate("jobplan_detail",function(){"zh"==i18n.options.lng?$("*[data-i18n]").i18n():($("#control_week").find(".zl-content-top-info-down-btn-img").attr("src","images/jobplan/icon_week-02.png"),$("#control_month").find(".zl-content-top-info-down-btn-img").attr("src","images/jobplan/icon_month-02.png"),$("#control_year").find(".zl-content-top-info-down-btn-img").attr("src","images/jobplan/icon_year-02.png"),$("*[data-i18n]").i18n())}),$("#select_box").selectboxs(),$("#select_box_part").selectboxs(),"false"==$("#myform\\:viewDisabled").val()&&$("#control_add,#control_edit,#control_del,#control_status,#control_week,#control_month,#control_year,#control_big,#control_small,#control_import,.zl-button-text").css("cursor","default").attr("onclick","return false;"),$(".zl-content-select").mouseover(function(){$(this).attr("title",$(this).find("input[type='text']").val())}),$.autosizeExclude($("#example-container")[0],!0)});var zflag=1,tipTitle1="",tipTitle2="",tipTitle3="",tipTitle4="",tipTitle5="",tipTitle6="",tipTitle7="",tipTitle8="",tipTitle9="",tipTitle10="",tipTitle11="",tipTitle12="",tipTitle13="",tipTitle14="",tipTitle15="";